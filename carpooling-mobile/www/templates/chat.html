<ion-view>
    <ion-nav-title>{{personName}}</ion-nav-title>
    <ion-content delegate-handle="userMessageScroll" overflow-scroll="true">
        <!-- ng-init="loadAllMsg()" -->
        <button ng-if="oldMsgPresent" class="button button-full button-light" ng-click="loadOldChat()">
            {{'lbl_old_chat' | translate}}
        </button>
        <div class="chat-wrapper">
            <!--            <ion-refresher pulling-icon="ion-ios-arrow-thin-down" refreshing-text="loading messages" on-refresh="moreMessages()">
            </ion-refresher>-->
            <!--<div ng-repeat="ms in messages" ng-last-repeat="messages">
                <div id="{{ ms.timestamp }}" class="card card-chat" ng-class="{'card-chat-my': (isMe(ms.userId) && !chatExtraLength(ms.text)), 'card-chat-my-extra': (isMe(ms.userId) && chatExtraLength(ms.text))}">
                    <div ng-if="!isMe(ms.userId)" class="item item-divider">
                        <span>{{ personName }} {{'msg_talk' | translate}}</span>
                    </div>
                    <div class="item">
                        <span>{{ ms.message }}</span>
                    </div>
                    <div class="item item-divider">
                        <label ng-if="isToday(ms.timestamp)">{{'lbl_today' | translate}}, </label>
                        <label ng-if="!isToday(ms.timestamp)">{{ ms.timestamp | date: dateDayMask }}, </label>
                        {{ ms.timestamp | date:'HH:mm' }}
                    </div>
                </div>
            </div>-->
            <div ng-repeat="ms in updatesMsg" ng-last-repeat="updatesMsg">
                <div id="{{ ms.timestamp }}" class="card card-chat" ng-class="{'card-chat-my': (isMe(ms.data.senderId) && !chatExtraLength(ms.data.message)), 'card-chat-my-extra': (isMe(ms.data.senderId) && chatExtraLength(ms.data.message))}">
                    <div ng-if="!isMe(ms.data.senderId)" class="item item-divider">
                        <span>{{ personName }} {{'msg_talk' | translate}}</span>
                    </div>
                    <div class="item">
                        <span>{{ ms.data.message }}</span>
                    </div>
                    <div class="item" ng-if="ms.type=='ParticipationRequest'">
                        <span>Passaggio richiesto</span>
                    </div>
                    <div class="item" ng-if="ms.type=='ParticipationResponse'">
                        <span ng-if="ms.data.status=='1'">Passaggio accettato</span>
                        <span ng-if="ms.data.status=='-1'">Passaggio rifiutato</span>
                    </div>
                    <div class="item item-divider">
                        <label ng-if="isToday(ms.timestamp)">{{'lbl_today' | translate}}, </label>
                        <label ng-if="!isToday(ms.timestamp)">{{ ms.timestamp | date: dateDayMask }}, </label>
                        {{ ms.timestamp | date:'HH:mm' }}
                    </div>
                </div>
            </div>
        </div>
    </ion-content>
    <ion-footer-bar keyboard-attach class="bar-stable item-input input-chat">
        <input type="text" placeholder="{{'send_msg_placeholder' | translate}}" ng-model="new_message" ng-focus="inputUp()" ng-blur="inputDown()">
        <button class="button button-carpooling icon ion-android-send" ng-click="sendMessage(new_message)">
            <!-- button-icon button-large -->
            <!--          <i class="icon ion-android-send"></i>-->
        </button>
    </ion-footer-bar>
</ion-view>
